# 31.ストリームデータ処理の実装

##<u>目的</u>
IoT サービスを実装する際、ストリームデータの取り扱いに工夫が必要になる
  - すぐに膨大なデータが溜まる
  - 直近のデータにはリアルタイムでの参照が必要
このため、業務アプリのような DB スキーマの設計ではシステムのカットイン後にしばらくして破綻するという嫌らしい破綻の仕方をする  
直近のデータにたいしては定数時間でのアクセスが必要で、IoT サービスはみな何らかの方法でキャッシュをおこなっていて、その部分の工夫が売りになっている  
本章では monitor がどのように`直近データへの定数時間でのアクセス`をシンプルに実装しているかその工夫を参考までに紹介する

##<u>実習手順</u>
自身の gc16 に terminal でログインする

### 準備
  - top コマンド、tail コマンド:  
  top コマンド、tail コマンドはそれぞれテキストファイルの先頭もしくは末尾から一定数の行数だけ抜き出すコマンド
  - time コマンド:
  `time コマンド` で、コマンドの経過時間を表示するコマンド
  - wc コマンド:
  テキストファイルの文字数、単語数、行数を表示するコマンド  
  `wc -l` で行数（line #)を表示する

### 実験データのコピー
Web サーバー上の実験データを自分の RPi にコピーする
```
pi@gc1624:~ $ rcp -rp gc1601.local:/home/pi/sample .
pi@gc1601.local's password:
stemp.csv.gz                                  100% 1075     1.1KB/s   00:00    
temp.csv.gz                                   100%  386KB 386.3KB/s   00:00    
10temp.csv.gz                                 100% 3863KB 772.6KB/s   00:05    
```

```
pi@gc1624:~ $ cd sample
pi@gc1624:~/sample $ ls
10temp.csv.gz  stemp.csv.gz  temp.csv.gz
pi@gc1624:~/sample $ gunzip *.gz
pi@gc1624:~/sample $ ls
10temp.csv  stemp.csv  temp.csv
```

### 実験


```
pi@gc1601:~/sample $ wc -l stemp.csv
300 stemp.csv
pi@gc1601:~/sample $ time tail -n 10 stemp.csv
2017/04/04 09:05:16,21.9
2017/04/04 09:10:17,21.8
2017/04/04 09:15:15,21.8
2017/04/04 09:20:16,21.9
2017/04/04 09:25:16,21.9
2017/04/04 09:30:15,22.0
2017/04/04 09:35:17,21.8
2017/04/04 09:40:16,21.9
2017/04/04 09:45:18,21.9
2017/04/04 09:50:18,22.0

real	0m0.004s
user	0m0.010s
sys	0m0.000s
```

0.003s - 0.006s

```
pi@gc1601:~/sample $ wc -l temp.csv
116223 temp.csv

pi@gc1601:~/sample $ time tail -n 10 temp.csv
2017/04/04 09:05:16,21.9
2017/04/04 09:10:17,21.8
2017/04/04 09:15:15,21.8
2017/04/04 09:20:16,21.9
2017/04/04 09:25:16,21.9
2017/04/04 09:30:15,22.0
2017/04/04 09:35:17,21.8
2017/04/04 09:40:16,21.9
2017/04/04 09:45:18,21.9
2017/04/04 09:50:18,22.0

real	0m0.004s
user	0m0.000s
sys	0m0.000s
```

```
pi@gc1601:~/sample $ wc -l 10temp.csv
1162230 10temp.csv
pi@gc1601:~/sample $ time tail -n 10 10temp.csv
2017/04/04 09:05:16,21.9
2017/04/04 09:10:17,21.8
2017/04/04 09:15:15,21.8
2017/04/04 09:20:16,21.9
2017/04/04 09:25:16,21.9
2017/04/04 09:30:15,22.0
2017/04/04 09:35:17,21.8
2017/04/04 09:40:16,21.9
2017/04/04 09:45:18,21.9
2017/04/04 09:50:18,22.0

real	0m0.004s
user	0m0.000s
sys	0m0.000s
```
